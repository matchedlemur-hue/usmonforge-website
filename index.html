<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="logo/png" href="./Images/icon-image-removebg-preview.png">
    <title>Pixel Forge: Your Gaming Hub</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font (required for standard Tailwind/Web design) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    
    <style>
        /* Custom styles for the immersive, dark gaming background */
        #gaming-bg {
            /* Dark background with radial gradients for a neon/sci-fi glow effect */
            background-color: #0b0f14;
            background-image: 
            radial-gradient(at 80% 0%, #172554 0%, transparent 50%), 
            radial-gradient(at 20% 100%, #581c87 0%, transparent 50%),
            linear-gradient(to bottom, #101725 0%, #0b0f14 100%);
            min-height: 100vh;
            color: #e5e7eb; /* Light gray text for contrast */
            font-family: 'Inter', sans-serif;
        }

        /* Neon button glow effect */
        .neon-button {
            transition: all 0.3s ease;
            box-shadow: 0 0 5px #06b6d4, 0 0 25px #06b6d4; /* Cyan glow */
        }
        .neon-button:hover {
            box-shadow: 0 0 10px #06b6d4, 0 0 40px #06b6d4, 0 0 80px #06b6d4;
            transform: translateY(-2px);
            background-color: #06b6d4;
            color: #111827;
        }

        /* Card hover effect */
        .game-card:hover {
            transform: scale(1.03);
            box-shadow: 0 15px 30px rgba(6, 182, 212, 0.4);
            border-color: #06b6d4;
        }
    </style>

    <!-- Load Firebase Modules -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // Import signOut function
        import { getAuth, onAuthStateChanged, signInAnonymously, signInWithCustomToken, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // Expose Firebase functions globally for use in the script below
        window.firebase = { 
            initializeApp, 
            getAuth, 
            onAuthStateChanged, 
            signInAnonymously,
            signInWithCustomToken,
            signOut // Expose signOut
        };
    </script>
</head>

<body id="gaming-bg">

    <!-- 1. Navigation Bar (Sticky and Responsive) -->
    <nav class="sticky top-0 z-50 bg-gray-900/90 backdrop-blur-sm shadow-2xl shadow-cyan-800/30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <a href="#" class="flex-shrink-0 text-2xl font-extrabold text-cyan-400 tracking-wider">
                    <span class="text-indigo-400">USMON</span> FORGE
                </a>

                <!-- Desktop Menu -->
                <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                    <a href="#" class="inline-flex items-center px-1 pt-1 border-b-2 border-cyan-500 text-sm font-medium text-white hover:text-cyan-400 transition duration-150">Home</a>
                    <a href="#featured" class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-300 hover:border-indigo-400 hover:text-white transition duration-150">Arcade</a>
                    <a href="#scores" class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-300 hover:border-indigo-400 hover:text-white transition duration-150">High Scores</a>
                    
                    <!-- New Link: Whack-A-Game -->
                    <a href="whack-a-game.html" class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-300 hover:border-indigo-400 hover:text-white transition duration-150">Whack-A-Game</a>
                    
                    <!-- DYNAMIC AUTH LINK CONTAINER - DESKTOP -->
                    <div id="auth-desktop-link-container" class="flex items-center">
                        <!-- Initial Login Link as Fallback (Replaced by JS on auth change) -->
                        <a href="login.html" class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-300 hover:border-indigo-400 hover:text-white transition duration-150">Login</a>
                    </div>
                </div>

                <!-- Mobile Menu Button (Hamburger) -->
                <div class="-mr-2 flex items-center sm:hidden">
                    <button id="mobile-menu-toggle" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-cyan-500">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu (Hidden by default) -->
        <div id="mobile-menu" class="sm:hidden hidden pb-3 space-y-1">
            <a href="#" class="block pl-3 pr-4 py-2 border-l-4 border-cyan-500 text-base font-medium text-white bg-gray-800/50">Home</a>
            <a href="#featured" class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-300 hover:bg-gray-800 hover:border-indigo-400">Arcade</a>
            <a href="./high-scores.html" class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-300 hover:bg-gray-800 hover:border-indigo-400">High Scores</a>
            
            <!-- New Mobile Link: Whack-A-Game -->
            <a href="whack-a-game.html" class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-300 hover:bg-gray-800 hover:border-indigo-400">Whack-A-Game</a>
            
            <!-- DYNAMIC AUTH LINK CONTAINER - MOBILE (Will hold Profile/Settings/Sign Out or Login) -->
            <div id="auth-mobile-link-container">
                <a href="login.html" class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-300 hover:bg-gray-800 hover:border-indigo-400">Login</a>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">

        <!-- 2. Hero Section -->
        <section class="text-center py-20 mb-16 rounded-xl border-4 border-gray-800 bg-gray-900/80 shadow-2xl shadow-indigo-600/20">
            <h1 class="text-5xl sm:text-7xl font-extrabold tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-indigo-400 mb-4">
                THE NEXT LEVEL OF FUN
            </h1>
            <p class="text-xl sm:text-2xl text-gray-400 mb-8 max-w-3xl mx-auto">
                Discover, play, and compete in our collection of retro-inspired and modern web games. Ready to challenge the leaderboards?
            </p>
            <a href="#featured" class="inline-block px-12 py-4 bg-indigo-600 rounded-full text-lg font-bold uppercase tracking-widest neon-button border-2 border-cyan-500">
                Start Playing Now
            </a>
        </section>

        <!-- 3. Featured Games Section -->
        <section id="featured" class="pt-12">
            <h2 class="text-4xl font-bold text-center mb-10 text-cyan-400">Featured Arcade Hits</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

                <!-- Game Card 1: Snake Clone -->
                <div class="game-card bg-gray-800 p-6 rounded-xl border-2 border-gray-700 shadow-xl transition duration-300 cursor-pointer hover:shadow-cyan-500/50">
                    <div class="h-32 bg-cyan-900 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-4xl text-cyan-300">üêç</span>
                    </div>
                    <h3 class="text-2xl font-semibold mb-2 text-white">Classic Snake</h3>
                    <p class="text-gray-400 mb-4">Classic high-score challenge. Grow your serpent and avoid the walls.</p>
                    <a href="windowed-snake.html" class="text-indigo-400 hover:text-indigo-300 font-medium">PLAY GAME &rarr;</a>
                </div>

                <!-- Game Card 2: Tower Defense Placeholder -->
                <div class="game-card bg-gray-800 p-6 rounded-xl border-2 border-gray-700 shadow-xl transition duration-300 cursor-pointer hover:shadow-indigo-500/50">
                    <div class="h-32 bg-indigo-900 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-4xl text-indigo-300">üè∞</span>
                    </div>
                    <h3 class="text-2xl font-semibold mb-2 text-white">Aether Keep</h3>
                    <p class="text-gray-400 mb-4">A minimalist tower defense game with wave-based enemies.</p>
                    <a href="#" class="text-indigo-400 hover:text-indigo-300 font-medium">COMING SOON &rarr;</a>
                </div>
                
                <!-- Game Card 3: Puzzle Placeholder -->
                <div class="game-card bg-gray-800 p-6 rounded-xl border-2 border-gray-700 shadow-xl transition duration-300 cursor-pointer hover:shadow-pink-500/50">
                    <div class="h-32 bg-pink-900 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-4xl text-pink-300">üß©</span>
                    </div>
                    <h3 class="text-2xl font-semibold mb-2 text-white">Neon Puzzle</h3>
                    <p class="text-gray-400 mb-4">Solve logic puzzles against the clock to earn rewards.</p>
                    <a href="#" class="text-indigo-400 hover:text-indigo-300 font-medium">COMING SOON &rarr;</a>
                </div>

            </div>
        </section>
        
    </main>
    
    <!-- 4. Footer Section -->
    <footer id="contact" class="bg-gray-900/90 mt-16 py-8 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-500">
            <p>&copy; 2025 Pixel Forge Gaming. All rights reserved.</p>
            <div class="mt-2 space-x-4">
                <a href="#" class="hover:text-cyan-400 transition duration-150">Terms</a>
                <span class="text-gray-600">|</span>
                <a href="#" class="hover:text-cyan-400 transition duration-150">Privacy</a>
            </div>
        </div>
    </footer>


    <script type="module">
        // JavaScript for mobile menu toggle
        document.getElementById('mobile-menu-toggle').addEventListener('click', function() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        });

        // --- Firebase Initialization and Auth Logic ---
        const LOCAL_FALLBACK_FIREBASE_CONFIG = {
            apiKey: "MOCK_API_KEY_LOCAL", 
            authDomain: "mock-project.firebaseapp.com",
            projectId: "mock-project-id",
        };
        
        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config) 
            : LOCAL_FALLBACK_FIREBASE_CONFIG;
        
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const isLocalFallback = firebaseConfig.apiKey === LOCAL_FALLBACK_FIREBASE_CONFIG.apiKey;
        
        const desktopContainer = document.getElementById('auth-desktop-link-container');
        const mobileContainer = document.getElementById('auth-mobile-link-container');
        
        let authInstance = null; // To store the Firebase Auth instance

        /**
         * Signs the user out of Firebase Auth.
         */
        window.handleSignOut = async function() {
            if (authInstance && window.firebase.signOut) {
                try {
                    await window.firebase.signOut(authInstance);
                    console.log("User signed out successfully.");
                } catch (error) {
                    console.error("Sign out failed:", error);
                }
            } else {
                console.error("Firebase Auth not initialized or signOut not available.");
            }
        }

        // Function to render the UI based on auth state
        function renderAuthUI(user) {
            
            // --- Desktop UI Update ---
            if (desktopContainer) {
                desktopContainer.innerHTML = ''; // Clear existing content
                if (user) {
                    // Logged in: Show Account Icon and Dropdown
                    const userDisplayId = user.uid ? user.uid.substring(0, 8) + '...' : 'Anonymous';

                    const iconHTML = `
                        <div class="relative">
                            <button id="user-menu-button-desktop" 
                                        class="inline-flex items-center p-1 text-gray-300 hover:text-cyan-400 transition duration-150 focus:outline-none" 
                                        aria-expanded="false" 
                                        aria-controls="user-menu-dropdown-desktop">
                                <!-- SVG User Icon -->
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </button>
                            
                            <!-- Dropdown Menu -->
                            <div id="user-menu-dropdown-desktop" class="absolute right-0 mt-2 w-48 rounded-md shadow-2xl py-1 bg-gray-700 ring-1 ring-cyan-500 ring-opacity-50 z-50 origin-top-right hidden">
                                <div class="py-1">
                                    <span class="block px-4 py-2 text-xs font-semibold text-cyan-400 border-b border-gray-600">User: ${userDisplayId}</span>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-200 hover:bg-gray-600 transition duration-150">My Profile</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-200 hover:bg-gray-600 transition duration-150">Settings</a>
                                    <a href="#" onclick="event.preventDefault(); window.handleSignOut();" 
                                        class="block px-4 py-2 text-sm text-red-400 hover:bg-red-900/50 transition duration-150 font-medium border-t border-gray-600 mt-1">Sign Out</a>
                                </div>
                            </div>
                        </div>
                    `;
                    desktopContainer.innerHTML = iconHTML;
                    
                    // Setup click listener for the desktop dropdown
                    const button = document.getElementById('user-menu-button-desktop');
                    const dropdown = document.getElementById('user-menu-dropdown-desktop');

                    button.addEventListener('click', function(event) {
                        event.stopPropagation(); // Prevents the document listener from immediately closing it
                        dropdown.classList.toggle('hidden');
                    });
                    
                    // Close menu if user clicks outside of the button and the dropdown
                    document.addEventListener('click', function(event) {
                        if (dropdown && !button.contains(event.target) && !dropdown.contains(event.target)) {
                            dropdown.classList.add('hidden');
                        }
                    });

                } else {
                    // Logged out: Original Login Link style
                    desktopContainer.innerHTML = `
                        <a href="login.html" class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-300 hover:border-indigo-400 hover:text-white transition duration-150">Login</a>
                    `;
                }
            }

            // --- Mobile UI Update ---
            if (mobileContainer) {
                mobileContainer.innerHTML = ''; // Clear existing content
                if (user) {
                    // Logged in: Show profile/settings/signout links stacked in the mobile menu
                    const mobileMenuHTML = `
                        <a href="#" class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-300 hover:bg-gray-800 hover:border-indigo-400">
                            My Profile
                        </a>
                        <a href="#" class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-300 hover:bg-gray-800 hover:border-indigo-400">
                            Settings
                        </a>
                        <a href="#" onclick="event.preventDefault(); window.handleSignOut();" 
                            class="block pl-3 pr-4 py-2 border-l-4 border-red-500 text-base font-medium text-red-400 hover:bg-red-900/50 hover:border-red-500">
                            Sign Out
                        </a>
                    `;
                    mobileContainer.innerHTML = mobileMenuHTML;
                } else {
                    // Logged out: Original Login Link style
                    mobileContainer.innerHTML = `
                        <a href="login.html" class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-300 hover:bg-gray-800 hover:border-indigo-400">Login</a>
                    `;
                }
            }
        }

        async function initializeFirebase() {
            try {
                if (!window.firebase) {
                    console.error("Firebase module not loaded.");
                    renderAuthUI(null); 
                    return;
                }

                const { initializeApp, getAuth, onAuthStateChanged, signInWithCustomToken, signInAnonymously } = window.firebase;
                
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                authInstance = auth; // Store the auth instance globally for signOut
                
                // Set up the listener first to immediately show the correct UI state
                onAuthStateChanged(auth, renderAuthUI);

                if (!isLocalFallback) {
                    // Production/Canvas environment: Perform required sign-in
                    if (auth.currentUser === null) {
                        try {
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                            } else {
                                await signInAnonymously(auth);
                            }
                        } catch (error) {
                            console.error("Initial Auth attempt failed:", error);
                        }
                    }
                } else {
                    // --- LOCAL FALLBACK MODE ---
                    // Simulate a signed-in state for local testing, ensuring the icon shows
                    console.warn("--- Local Mode: Simulating Anonymous Signed-In State for UI ---");
                    const mockUser = {
                        uid: 'MOCK-LOCAL-USER',
                        isAnonymous: true,
                        email: 'mock@user.com',
                    };
                    // Since onAuthStateChanged might not fire in mock mode, manually call renderAuthUI
                    renderAuthUI(mockUser);
                }

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                renderAuthUI(null); 
            }
        }

        initializeFirebase();
    </script>
</body>
</html>